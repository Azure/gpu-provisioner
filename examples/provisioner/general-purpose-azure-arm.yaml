# This example provisioner will provision general purpose instances
apiVersion: karpenter.sh/v1alpha5
kind: Provisioner
metadata:
  name: default
spec:
  # weight: 50

  consolidation:
    enabled: true
  
  # ttlSecondsAfterEmpty: 30
  # ttlSecondsUntilExpired: 86400   # one day

  limits:
    resources:
      cpu: 10

  requirements:
  # D series with premium storage
  - key: karpenter.k8s.azure/sku-family
    operator: In
    values: [D]
  - key: karpenter.k8s.azure/sku-storage-premium-capable
    operator: In
    values: ['true']
  # Try ARM ...
  - key: kubernetes.io/arch
    operator: In
    values: ['arm64']

  # exclude very large SKUs (32+ vCPU)
  - key: karpenter.k8s.azure/sku-cpu
    operator: Lt
    values: ["33"]

  # allow spot
  #- key: kubernetes.sh/capacity-type
  #  operator: In
  #  values: [spot,regular]

  # currently provisioning nodes with EnableAcceleratedNetworking:true, so need SKUs capable of that
  - key: karpenter.k8s.azure/sku-networking-accelerated
    operator: In
    values: ['true']
