namespace: gpu-provisioner
# -- Overrides the chart's name.
nameOverride: ""
# -- Overrides the chart's computed fullname.
fullnameOverride: ""
# -- Additional labels to add into metadata.
additionalLabels: {}
# app: gpu-provisioner

# -- Additional annotations to add into metadata.
additionalAnnotations: {}
# -- Image pull policy for Docker images.
imagePullPolicy: Always
# -- Image pull secrets for Docker images.
imagePullSecrets: []
serviceAccount:
  # -- Specifies if a ServiceAccount should be created.
  create: true
  # -- The name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template.
  name: ""
  # -- Additional annotations for the ServiceAccount.
  annotations: {}
# -- Specifies additional rules for the core ClusterRole.
additionalClusterRoleRules: []
serviceMonitor:
  # -- Specifies whether a ServiceMonitor should be created.
  enabled: false
  # -- Additional labels for the ServiceMonitor.
  additionalLabels: {}
  # -- Endpoint configuration for the ServiceMonitor.
  endpointConfig: {}
# -- Number of replicas.
replicas: 1
# -- The number of old ReplicaSets to retain to allow rollback.
revisionHistoryLimit: 10
# -- Strategy for updating the pod.
strategy:
  rollingUpdate:
    maxUnavailable: 1
# -- Additional labels for the pod.
podLabels: {}
# -- Additional annotations for the pod.
podAnnotations: {}
podDisruptionBudget:
  name: karpenter
  maxUnavailable: 1
# -- SecurityContext for the pod.
podSecurityContext:
  fsGroup: 1000
# -- PriorityClass name for the pod.
priorityClassName: system-cluster-critical
# -- Override the default termination grace period for the pod.
terminationGracePeriodSeconds:
# -- Bind the pod to the host network.
# This is required when using a custom CNI.
hostNetwork: false
# -- Configure the DNS Policy for the pod
dnsPolicy: Default
# -- Configure DNS Config for the pod
dnsConfig: {}
#  options:
#    - name: ndots
#      value: "1"
# -- Node selectors to schedule the pod to nodes with labels.
nodeSelector:
  kubernetes.io/os: linux
# -- Affinity rules for scheduling the pod. If an explicit label selector is not provided for pod affinity or pod anti-affinity one will be created from the pod selector labels.
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.azure.com/cluster
          operator: Exists
        - key: type
          operator: NotIn
          values:
          - virtual-kubelet
        - key: kubernetes.io/os
          operator: In
          values:
          - linux
      - matchExpressions:
        - key: karpenter.sh/provisioner-name
          operator: DoesNotExist
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - topologyKey: "kubernetes.io/hostname"
# -- Topology spread constraints to increase the controller resilience by distributing pods across the cluster zones. If an explicit label selector is not provided one will be created from the pod selector labels.
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
# -- Tolerations to allow the pod to be scheduled to nodes with taints.
tolerations:
  - key: CriticalAddonsOnly
    operator: Exists
# -- Additional volumes for the pod.
extraVolumes: []
# - name: aws-iam-token
#   projected:
#     defaultMode: 420
#     sources:
#     - serviceAccountToken:
#         audience: sts.amazonaws.com
#         expirationSeconds: 86400
#         path: token
controller:
  image:
    # -- Repository path to the controller image.
    repository: aimodelsregistry.azurecr.io/gpu-provisioner
    # -- Tag of the controller image.
    tag: 0.1.0
    # -- SHA256 digest of the controller image.
    digest: ""
  # -- SecurityContext for the controller container.
  securityContext: {}
  # -- Additional environment variables for the controller pod.
  env:
    - name: ARM_SUBSCRIPTION_ID
      value: 
    - name: LOCATION
      value: eastus
    - name: ARM_USE_MANAGED_IDENTITY_EXTENSION
      value: "true"
    - name: ARM_USER_ASSIGNED_IDENTITY_ID
      value: 
    - name: AZURE_CLUSTER_NAME
      value: new_demo
    - name: AZURE_NODE_RESOURCE_GROUP
      value: lMC_llm-test_new_demo_eastus
    - name: ARM_RESOURCE_GROUP
      value: llm-test
    # TODO: move to settings
    - name: AZURE_SUBNET_ID # the id of subnet to create network interfaces on
      value: /subscriptions/ff05f55d-22b5-44a7-b704-f9a8efd493ed/resourceGroups/MC_llm-test_new_demo_eastus/providers/Microsoft.Network/virtualNetworks/aks-vnet-16592489/subnets/aks-subnet
    - name: LEADER_ELECT # disable leader election for better debugging experience
      value: "false"
  envFrom: []
  # -- Resources for the controller pod.
  resources:
    requests:
      cpu: 200m
    limits:
      cpu: 500m

  # -- Controller outputPaths - default to stdout only
  outputPaths:
    - stdout
  # -- Controller errorOutputPaths - default to stderr only
  errorOutputPaths:
    - stderr
  # -- Controller log level, defaults to the global log level
  logLevel: debug
  # -- Controller log encoding, defaults to the global log encoding
  logEncoding: ""
  # -- Additional volumeMounts for the controller pod.
  extraVolumeMounts: []
  # - name: aws-iam-token
  #   mountPath: /var/run/secrets/eks.amazonaws.com/serviceaccount
  #   readOnly: true
  # -- Additional sidecarContainer config
  sidecarContainer: []
  # -- Additional volumeMounts for the sidecar - this will be added to the volume mounts on top of extraVolumeMounts
  sidecarVolumeMounts: []
  metrics:
    # -- The container port to use for metrics.
    port: 8000
  healthProbe:
    # -- The container port to use for http health probe.
    port: 8081
# -- Global log level
logLevel: debug
# -- Global log encoding
logEncoding: console
# -- Global Settings to configure gpu-provisioner
settings:
  # -- The maximum length of a batch window. The longer this is, the more pods we can consider for provisioning at one
  # time which usually results in fewer but larger nodes.
  batchMaxDuration: 10s
  # -- The maximum amount of time with no new ending pods that if exceeded ends the current batching window. If pods arrive
  # faster than this time, the batching window will be extended up to the maxDuration. If they arrive slower, the pods
  # will be batched separately.
  batchIdleDuration: 1s
  # -- Azure-specific configuration values
  azure:
    # -- Cluster name.
    clusterName: new_demo
    # -- Cluster endpoint.
    clusterEndpoint: https://newdemo-llm-test-ff05f5-vs68qyru.hcp.eastus.azmk8s.io:443
    # -- The VM memory overhead as a percent that will be subtracted from the total memory for all instance types
    # TODO: not used yet ...
    vmMemoryOverheadPercent: 0.075
    # TODO: autogenerate
    sshPublicKey: 
    networkPlugin: "kubenet" # TODO: get this from the cluster
    networkPolicy: ""
    # -- The global tags to use on all Azure infrastructure resources (VMs, etc.)
    # TODO: not propagated yet ...
    tags:
  # -- Feature Gate configuration values. Feature Gates will follow the same graduation process and requirements as feature gates
  # in Kubernetes. More information here https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/#feature-gates-for-alpha-or-beta-features
  featureGates:
    # -- driftEnabled is in ALPHA and is disabled by default.
    # Setting driftEnabled to true enables the drift deprovisioner to watch for drift between currently deployed nodes
    # and the desired state of nodes set in provisioners and node templates
    driftEnabled: false